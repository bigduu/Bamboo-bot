# æµ‹è¯•è„šæœ¬ä½¿ç”¨æŒ‡å—

## é—®é¢˜èƒŒæ™¯

åœ¨å¼€å‘å’Œæµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¯åŠ¨/åœæ­¢ `web_service_standalone` æœåŠ¡å™¨ã€‚å¦‚æœç®¡ç†ä¸å½“ï¼Œä¼šå¯¼è‡´ï¼š
- ç«¯å£è¢«å ç”¨ï¼ˆéœ€è¦ä¸æ–­æ¢ç«¯å£ï¼‰
- æ®‹ç•™è¿›ç¨‹å ç”¨èµ„æº
- æµ‹è¯•ç»“æœä¸å‡†ç¡®

## è§£å†³æ–¹æ¡ˆ

æä¾›äº†ä¸¤ä¸ªè„šæœ¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

### 1. è‡ªåŠ¨æ¸…ç†çš„æµ‹è¯•è„šæœ¬ï¼š`test-static-serving.sh`

**åŠŸèƒ½**ï¼š
- âœ… è‡ªåŠ¨å¯åŠ¨æœåŠ¡å™¨
- âœ… è¿è¡Œå®Œæ•´æµ‹è¯•ï¼ˆAPIã€å‰ç«¯ã€é™æ€èµ„æºï¼‰
- âœ… é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†è¿›ç¨‹ï¼ˆå³ä½¿ Ctrl+C ä¹Ÿèƒ½æ¸…ç†ï¼‰
- âœ… ä½¿ç”¨å›ºå®šç«¯å£ï¼Œä¸ä¼šå†²çª

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
./test-static-serving.sh
```

**æµ‹è¯•å†…å®¹**ï¼š
1. API å¥åº·æ£€æŸ¥ (`/api/v1/health`)
2. å‰ç«¯é¦–é¡µ (`/`)
3. é™æ€èµ„æºåŠ è½½ (`/assets/*.js`)
4. æœåŠ¡å™¨æ—¥å¿—éªŒè¯

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨ç«¯å£ 9080ï¼ˆå›ºå®šï¼Œä¸ä¼šå†²çªï¼‰
- è‡ªåŠ¨è®°å½• PID åˆ° `/tmp/web_service_test_9080.pid`
- é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†è¿›ç¨‹å’Œ PID æ–‡ä»¶
- æ”¯æŒ Ctrl+C ä¼˜é›…é€€å‡º

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
=========================================
é™æ€æ–‡ä»¶æœåŠ¡æµ‹è¯•
=========================================
ç«¯å£: 9080

1. å¯åŠ¨æœåŠ¡å™¨...
æœåŠ¡å™¨ PID: 7354

2. ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨...
æœåŠ¡å™¨å·²å¯åŠ¨ (ç­‰å¾… 3 ç§’)

3. æµ‹è¯• API å¥åº·æ£€æŸ¥...
âœ… API å¥åº·æ£€æŸ¥é€šè¿‡: OK

4. æµ‹è¯•å‰ç«¯é¦–é¡µ...
âœ… å‰ç«¯é¦–é¡µæ­£å¸¸

5. æµ‹è¯•é™æ€èµ„æº...
âœ… é™æ€èµ„æºæ­£å¸¸: /assets/main-BAyZuR44.js (HTTP 200)

6. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—...
âœ… Serving static files from: "./dist"

=========================================
æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ âœ…
=========================================

æœåŠ¡å™¨å°†ç»§ç»­è¿è¡Œï¼Œä½ å¯ä»¥æ‰‹åŠ¨æµ‹è¯•ï¼š
  å‰ç«¯: http://127.0.0.1:9080/
  API:  http://127.0.0.1:9080/api/v1/health

æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨å¹¶é€€å‡º...
```

### 2. æ‰‹åŠ¨æ¸…ç†è„šæœ¬ï¼š`cleanup-server.sh`

**åŠŸèƒ½**ï¼š
- âœ… æŸ¥æ‰¾æ‰€æœ‰è¿è¡Œä¸­çš„ `web_service_standalone` è¿›ç¨‹
- âœ… æ˜¾ç¤ºè¿›ç¨‹è¯¦æƒ…ï¼ˆPIDã€å‘½ä»¤è¡Œå‚æ•°ï¼‰
- âœ… äº¤äº’å¼ç¡®è®¤ååœæ­¢è¿›ç¨‹
- âœ… æ¸…ç†æ‰€æœ‰ç›¸å…³çš„ PID æ–‡ä»¶

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# æŸ¥æ‰¾å¹¶æ¸…ç†æ®‹ç•™è¿›ç¨‹
./cleanup-server.sh
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
æŸ¥æ‰¾ web_service_standalone è¿›ç¨‹...

æ‰¾åˆ°ä»¥ä¸‹è¿›ç¨‹:
7354 /Users/bigduu/.cargo/bin/cargo run -p web_service_standalone -- serve --port 9080
7401 target/debug/web_service_standalone serve --port 9080

æ˜¯å¦åœæ­¢è¿™äº›è¿›ç¨‹? [y/N] y
åœæ­¢è¿›ç¨‹ä¸­...
  åœæ­¢ PID 7354...
  åœæ­¢ PID 7401...
æ¸…ç†å®Œæˆ
```

## å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æµ‹è¯•é™æ€æ–‡ä»¶æœåŠ¡åŠŸèƒ½
```bash
# ä¸€é”®æµ‹è¯•ï¼Œè‡ªåŠ¨æ¸…ç†
./test-static-serving.sh
```

### åœºæ™¯ 2: å‘ç°æœ‰è¿›ç¨‹æ®‹ç•™
```bash
# æŸ¥æ‰¾å¹¶æ¸…ç†æ‰€æœ‰æ®‹ç•™è¿›ç¨‹
./cleanup-server.sh
```

### åœºæ™¯ 3: æ‰‹åŠ¨å¯åŠ¨æœåŠ¡å™¨æµ‹è¯•
```bash
# ç»ˆç«¯ 1: å¯åŠ¨æœåŠ¡å™¨
cargo run -p web_service_standalone -- serve --port 8080 --static-dir ./dist

# ç»ˆç«¯ 2: æµ‹è¯•
curl http://127.0.0.1:8080/
curl http://127.0.0.1:8080/api/v1/health

# å®Œæˆåï¼Œç»ˆç«¯ 1 æŒ‰ Ctrl+C åœæ­¢

# å¦‚æœå¿˜è®°åœæ­¢ï¼Œä½¿ç”¨æ¸…ç†è„šæœ¬
./cleanup-server.sh
```

### åœºæ™¯ 4: æµ‹è¯•ä¸åŒçš„é…ç½®
```bash
# æµ‹è¯• 1: é»˜è®¤é…ç½®ï¼ˆæ— é™æ€æ–‡ä»¶ï¼‰
cargo run -p web_service_standalone -- serve --port 8080
# Ctrl+C åœæ­¢

# æµ‹è¯• 2: å¸¦é™æ€æ–‡ä»¶
cargo run -p web_service_standalone -- serve --port 8080 --static-dir ./dist
# Ctrl+C åœæ­¢

# å¦‚æœæœ‰æ®‹ç•™ï¼Œæ¸…ç†
./cleanup-server.sh
```

## æŠ€æœ¯ç»†èŠ‚

### è‡ªåŠ¨æ¸…ç†æœºåˆ¶

`test-static-serving.sh` ä½¿ç”¨ `trap` å‘½ä»¤ç¡®ä¿é€€å‡ºæ—¶æ¸…ç†ï¼š

```bash
# è®¾ç½®é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†
trap cleanup EXIT

cleanup() {
    # 1. è¯»å– PID æ–‡ä»¶
    # 2. ä¼˜é›…ç»ˆæ­¢ (kill)
    # 3. ç­‰å¾… 5 ç§’
    # 4. å¼ºåˆ¶ç»ˆæ­¢ (kill -9) å¦‚æœè¿˜åœ¨
    # 5. æ¸…ç† PID æ–‡ä»¶
}
```

**æ”¯æŒçš„é€€å‡ºæ–¹å¼**ï¼š
- âœ… è„šæœ¬æ­£å¸¸é€€å‡º
- âœ… Ctrl+C ä¸­æ–­
- âœ… æµ‹è¯•å¤±è´¥é€€å‡º
- âœ… è¢«å…¶ä»–ä¿¡å·ç»ˆæ­¢

### è¿›ç¨‹ç®¡ç†ç­–ç•¥

1. **PID æ–‡ä»¶**ï¼š`/tmp/web_service_test_{PORT}.pid`
   - è®°å½•æœåŠ¡å™¨è¿›ç¨‹ ID
   - é˜²æ­¢é‡å¤å¯åŠ¨
   - æ–¹ä¾¿æ¸…ç†

2. **ä¼˜é›…å…³é—­**ï¼š
   - å…ˆå‘é€ SIGTERM (kill)
   - ç­‰å¾…è¿›ç¨‹è‡ªå·±é€€å‡º
   - æœ€å¤šç­‰å¾… 5 ç§’
   - è¶…æ—¶å SIGKILL (kill -9)

3. **æ¸…ç†éªŒè¯**ï¼š
   - æ£€æŸ¥è¿›ç¨‹æ˜¯å¦çœŸæ­£é€€å‡º
   - æ¸…ç†æ‰€æœ‰ç›¸å…³è¿›ç¨‹
   - åˆ é™¤ä¸´æ—¶æ–‡ä»¶

### ç«¯å£é€‰æ‹©

æµ‹è¯•è„šæœ¬ä½¿ç”¨ç«¯å£ **9080** è€Œä¸æ˜¯ 8080ï¼š
- é¿å…ä¸å¼€å‘æ—¶ä½¿ç”¨çš„ 8080 å†²çª
- å›ºå®šç«¯å£ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½æ¢
- å®¹æ˜“è®°å¿†ï¼ˆ9xxx è¡¨ç¤ºæµ‹è¯•ï¼‰

## æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **ä½¿ç”¨è‡ªåŠ¨æµ‹è¯•è„šæœ¬**ï¼š
   ```bash
   ./test-static-serving.sh
   ```
   - è‡ªåŠ¨å¯åŠ¨ã€æµ‹è¯•ã€æ¸…ç†

2. **æµ‹è¯•å®Œæˆåç«‹å³æ¸…ç†**ï¼š
   ```bash
   # æ‰‹åŠ¨æµ‹è¯•å
   ./cleanup-server.sh
   ```

3. **å®šæœŸæ£€æŸ¥æ®‹ç•™è¿›ç¨‹**ï¼š
   ```bash
   # æ¯å¤©ä¸‹ç­å‰
   ./cleanup-server.sh
   ```

### âŒ é¿å…çš„åšæ³•

1. **ä¸æ–­æ¢ç«¯å£**ï¼š
   ```bash
   # âŒ ä¸å¥½
   cargo run --port 8080  # è¢«å ç”¨
   cargo run --port 8081  # åˆè¢«å ç”¨
   cargo run --port 8082  # è¿˜æ˜¯è¢«å ç”¨
   ```

2. **å¿˜è®°åœæ­¢è¿›ç¨‹**ï¼š
   ```bash
   # âŒ ä¸å¥½
   cargo run --port 8080 &
   # å¿˜è®°åœæ­¢ï¼Œè¿›ç¨‹ä¸€ç›´è¿è¡Œ
   ```

3. **æš´åŠ›æ¸…ç†**ï¼š
   ```bash
   # âŒ ä¸å¥½ - å¯èƒ½è¯¯æ€å…¶ä»–è¿›ç¨‹
   pkill -9 web_service
   ```

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ç«¯å£ä»ç„¶è¢«å ç”¨

**ç—‡çŠ¶**ï¼š
```
Failed to bind server: Address already in use (os error 48)
```

**è§£å†³**ï¼š
```bash
# 1. æŸ¥æ‰¾å ç”¨è¿›ç¨‹
lsof -i :9080

# 2. æ¸…ç†æ‰€æœ‰æ®‹ç•™
./cleanup-server.sh

# 3. å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œæ‰‹åŠ¨æ¸…ç†
kill -9 $(lsof -t -i:9080)
```

### é—®é¢˜ 2: è„šæœ¬æ— æ³•æ‰§è¡Œ

**ç—‡çŠ¶**ï¼š
```
bash: ./test-static-serving.sh: Permission denied
```

**è§£å†³**ï¼š
```bash
chmod +x test-static-serving.sh cleanup-server.sh
```

### é—®é¢˜ 3: dist ç›®å½•ä¸å­˜åœ¨

**ç—‡çŠ¶**ï¼š
```
é”™è¯¯: å‰ç«¯æ„å»ºç›®å½•ä¸å­˜åœ¨: ./dist
```

**è§£å†³**ï¼š
```bash
npm run build
```

### é—®é¢˜ 4: æœåŠ¡å™¨å¯åŠ¨è¶…æ—¶

**ç—‡çŠ¶**ï¼š
```
é”™è¯¯: æœåŠ¡å™¨å¯åŠ¨è¶…æ—¶
```

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥æ—¥å¿—
cat /tmp/web_service_test.log

# æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
cargo run -p web_service_standalone -- serve --port 9080 --static-dir ./dist
```

## ç›¸å…³å‘½ä»¤å‚è€ƒ

### æŸ¥æ‰¾ç«¯å£å ç”¨
```bash
# æ–¹æ³• 1: lsof
lsof -i :8080

# æ–¹æ³• 2: netstat
netstat -an | grep 8080

# æ–¹æ³• 3: ps + grep
ps aux | grep web_service_standalone
```

### æ‰‹åŠ¨æ¸…ç†è¿›ç¨‹
```bash
# æŸ¥æ‰¾è¿›ç¨‹
ps aux | grep web_service_standalone | grep -v grep

# ä¼˜é›…åœæ­¢
kill <PID>

# å¼ºåˆ¶åœæ­¢
kill -9 <PID>

# æ¸…ç†æ‰€æœ‰
pkill -f web_service_standalone
```

### æµ‹è¯•ç«¯ç‚¹
```bash
# å¥åº·æ£€æŸ¥
curl http://127.0.0.1:9080/api/v1/health

# å‰ç«¯é¦–é¡µ
curl http://127.0.0.1:9080/

# æµè§ˆå™¨è®¿é—®
open http://127.0.0.1:9080/
```

## æ€»ç»“

ä½¿ç”¨è¿™ä¸¤ä¸ªè„šæœ¬å¯ä»¥å®Œå…¨è§£å†³è¿›ç¨‹ç®¡ç†é—®é¢˜ï¼š

| è„šæœ¬ | ç”¨é€” | ç‰¹ç‚¹ |
|------|------|------|
| `test-static-serving.sh` | è‡ªåŠ¨åŒ–æµ‹è¯• | å…¨è‡ªåŠ¨ã€å›ºå®šç«¯å£ã€è‡ªåŠ¨æ¸…ç† |
| `cleanup-server.sh` | æ‰‹åŠ¨æ¸…ç† | äº¤äº’å¼ã€å®‰å…¨ã€å…¨é¢ |

**æ¨èå·¥ä½œæµ**ï¼š
1. å¼€å‘æ—¶ä½¿ç”¨ `./test-static-serving.sh` æµ‹è¯•
2. å®šæœŸè¿è¡Œ `./cleanup-server.sh` æ£€æŸ¥æ®‹ç•™
3. æ‰‹åŠ¨æµ‹è¯•åç«‹å³æ¸…ç†

ä¸å†éœ€è¦ä¸æ–­æ¢ç«¯å£ï¼ ğŸ‰
